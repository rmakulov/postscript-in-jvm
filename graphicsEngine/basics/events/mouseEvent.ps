%/snapshot save def
/evType exch def
transform
/evY exch def
/evX exch def

%---
%params: dict - gelement
%        name - evType
%        int  - x
%        int  - y
/checkElement {

    /evY exch def
    /evX exch def
    /evType exch def
    /element exch def

    element evX evY element /checkBelonging get exec
    {
        gelements /mouseX evX put
        gelements /mouseY evY put
        element evType findAncestorWithEventType
    } if
} def

%---
%params: dict - gelement
%        name - evType
/findAncestorWithEventType{

    /evType exch def
    /element exch def
    /eventProcs element /eventProcs get def

    eventProcs evType known
    
    {element dup setFocusedElement
        eventProcs evType get execList  exit
    }
    {
        /parent element /parent get def

        parent null eq
        {exit}
        {parent evType findAncestorWithEventType}
        ifelse
    }
    ifelse

} def


/search {gelements /maxElementNumber get 1 sub -1 0 {gelements exch get evType evX evY checkElement} for} def

evType (DRAG) cvn eq
{         gelements /mouseX evX put
          gelements /mouseY evY put
          dragElement

}
{
    evType (PRESS) cvn eq
    {
        gelements /lastX evX put
        gelements /lastY evY put}
    if

    search }
ifelse


%snapshot restore
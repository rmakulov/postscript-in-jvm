%PROLOG
%---
/window <</label (window) /x 0 /y 0 /height 843 /width 651  /parent null /children null /paint {pop} /eventProcs <<>> >> def
%---
/addElement {gelements gelements /maxElementNumber get 3 2 roll put  gelements /maxElementNumber gelements /maxElementNumber get 1 add put } def
%---
/button {
    /proc exch def
    /parent exch def
    /label exch def
    /h exch def
    /w exch def
    /y exch def
    /x exch def
    /paint {/bd exch def
                bd /x get
                bd /y get
                bd /w get
                bd /h get
                bd /label get

                bd /isPressed get
                {(/home/user/dev/IdeaProjects/postscript-in-jvm/graphicsEngine/basics/PressedButton.ps) (r) file run}
                    {(/home/user/dev/IdeaProjects/postscript-in-jvm/graphicsEngine/basics/UnpressedButton.ps) (r) file run}
                ifelse
        } def
        %eventProcs - procedures for each type of events
    /buttonDict <</label label /x x /y y /h h /w w  /parent parent /children null
                        /paint /paint load
                        /eventProcs <</CLICK /proc load>>
                        /isPressed false
    >> def



    buttonDict addElement

    %element - event, действие забирает один элемент со стека - графический элемент. В момент вызова процедуры в checkElement event.ps кладем buttonDict
    buttonDict /eventProcs get /RELEASE { /isPressed false put repaintAll} put
    buttonDict /eventProcs get /PRESS { /isPressed true put repaintAll} put
%
    parent /children [buttonDict parent /children get] put
    %x y h w label paint
    buttonDict paint
} def
%---
/checkBox {
    /proc exch def
    /parent exch def
    /label exch def
    /h exch def
    /y exch def
    /x exch def
    /paint {/bd exch def
                bd /x get
                bd /y get
                bd /h get
                bd /label get
                bd /isPressed get
                {(/home/user/dev/IdeaProjects/postscript-in-jvm/graphicsEngine/basics/PressedCheckbox.ps) (r) file run}
                    {(/home/user/dev/IdeaProjects/postscript-in-jvm/graphicsEngine/basics/UnpressedCheckbox.ps) (r) file run}
                ifelse
        } def
        %eventProcs - procedures for each type of events
    /checkboxDict <</label label /x x /y y /w h /h h /parent parent /children null
                        /paint /paint load
                        /eventProcs <</CLICK /proc load>>
                        /isPressed false
    >> def



    checkboxDict addElement

    %element - event, действие забирает один элемент со стека - графический элемент. В момент вызова процедуры в checkElement event.ps кладем checkboxDict
    checkboxDict /eventProcs get /RELEASE {dup /isPressed get /isPressed exch not put repaintAll} put
    %checkboxDict /eventProcs get /PRESS { dup /isPressed get /isPressed exch not put repaintAll} put

    parent /children [checkboxDict parent /children get] put
    %x y h w label paint
    checkboxDict paint
} def
%---
/invertString {
    dup
    /len exch length def
    /outStr len string def
    /i len 1 sub def
    {outStr i  3 2 roll put /i i 1 sub def} forall
    outStr
} def
%---
/repaintAll {
      init
      0 1 gelements /maxElementNumber get 1 sub {gelements exch get dup /paint get exec} for
    } def
%---
/invertLabels {
    0 1 gelements /maxElementNumber get 1 sub
    {
        gelements exch get
        dup
            /label get
        invertString
        /label exch put
    } for
} def
%---
/getGelement {
       transform
       /pointY exch def
       /pointX exch def
       gelements /maxElementNumber get 1 sub -1 0 {
                gelements exch get
                /element exch def
                /x element /x get def
                /y element /y get def
                /w element /w get def
                /h element /h get def

                pointX x ge pointY y ge and
                x w add pointX ge y h add pointY ge and
                and
                {element exit}
                if
       } for
} def


%END_PROLOG

/gelements 1 dict def
gelements /maxElementNumber 0 put
window addElement



